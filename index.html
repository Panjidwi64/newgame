<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>3D Cinema POV</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    html,body{margin:0;height:100%;background:#000;overflow:hidden;font-family:system-ui,Arial}
    #hint{position:fixed;left:12px;bottom:10px;color:#aaa;font-size:12px;opacity:.8}
  </style>
</head>
<body>
  <div id="hint">Gerakkan mouse untuk melihat sekeliling â€¢ Scroll = sedikit zoom</div>

  <script type="module">
    import * as THREE from "https://unpkg.com/three@0.160.0/build/three.module.js";

    // --- scene / camera / renderer ---
    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0x050508);

    const camera = new THREE.PerspectiveCamera(70, innerWidth/innerHeight, 0.1, 1000);
    camera.position.set(0, 1.25, 6.5); // tinggi kira-kira posisi duduk, agak jauh dari layar

    const renderer = new THREE.WebGLRenderer({ antialias:true });
    renderer.setSize(innerWidth, innerHeight);
    renderer.outputColorSpace = THREE.SRGBColorSpace;
    document.body.appendChild(renderer.domElement);

    // --- ruangan bioskop (kotak besar, terlihat sisi dalam) ---
    const room = new THREE.Mesh(
      new THREE.BoxGeometry(20, 10, 20),
      new THREE.MeshStandardMaterial({ color:0x0c0f17, side:THREE.BackSide, roughness:1, metalness:0 })
    );
    scene.add(room);

    // lantai karpet gelap
    const floor = new THREE.Mesh(
      new THREE.PlaneGeometry(20, 20),
      new THREE.MeshStandardMaterial({ color:0x111319, roughness:1 })
    );
    floor.rotation.x = -Math.PI/2;
    floor.position.y = 0;
    scene.add(floor);

    // --- layar bioskop: video texture ---
    const video = document.createElement('video');
    video.src = "media/ad1.mp4"; // ganti dengan video promomu
    video.loop = true; video.muted = true; video.autoplay = true; video.playsInline = true;
    video.play();

    const videoTex = new THREE.VideoTexture(video);
    videoTex.colorSpace = THREE.SRGBColorSpace;

    // ukuran layar 16:9
    const screenW = 8.0, screenH = screenW * 9/16;
    const screen = new THREE.Mesh(
      new THREE.PlaneGeometry(screenW, screenH),
      new THREE.MeshBasicMaterial({ map: videoTex })
    );
    screen.position.set(0, 2.8, -8.9); // dinding depan (z negatif)
    scene.add(screen);

    // bingkai & glow sederhana (emissive bar di tepi)
    const frameGeo = new THREE.PlaneGeometry(screenW+0.2, screenH+0.2);
    const frame = new THREE.Mesh(
      frameGeo,
      new THREE.MeshBasicMaterial({ color:0x090b10 })
    );
    frame.position.copy(screen.position);
    frame.position.z -= 0.01;
    scene.add(frame);

    // lampu ambient lembut + spotlight dari proyektor
    scene.add(new THREE.AmbientLight(0x404040, 0.7));
    const projector = new THREE.SpotLight(0xffffff, 1.1, 0, Math.PI/7, 0.25, 1.5);
    projector.position.set(0, 3.2, 6.2);
    projector.target = screen;
    projector.castShadow = false;
    scene.add(projector);

    // kursi penonton siluet (beberapa deret depan kamera)
    const audience = new THREE.Group();
    const headMat = new THREE.MeshBasicMaterial({ color:0x000000 });
    for (let i=0;i<12;i++){
      const head = new THREE.Mesh(new THREE.SphereGeometry(0.18, 16, 12), headMat);
      const row = i<6 ? 0 : 1;
      const col = (i%6) - 2.5;
      head.position.set(col*0.6, 1.05 + (Math.random()*0.04), 5.2 - row*0.6);
      audience.add(head);
      const body = new THREE.Mesh(new THREE.CylinderGeometry(0.22, 0.28, 0.5, 12), headMat);
      body.position.set(head.position.x, 0.75, head.position.z);
      audience.add(body);
    }
    scene.add(audience);

    // --- kontrol pandangan pakai mouse (tanpa pointer lock) ---
    let targetYaw = 0, targetPitch = 0;   // dalam radian
    let yaw = 0, pitch = 0;               // nilai yang diinterpolasi agar halus
    const maxYaw = THREE.MathUtils.degToRad(12);
    const maxPitch = THREE.MathUtils.degToRad(8);

    function onMouseMove(e){
      const nx = (e.clientX / innerWidth) * 2 - 1;   // -1..1
      const ny = (e.clientY / innerHeight) * 2 - 1;
      targetYaw = nx * maxYaw;
      targetPitch = -ny * maxPitch;
    }
    addEventListener('mousemove', onMouseMove);

    // zoom ringan via scroll (tidak mengubah posisi kursi)
    addEventListener('wheel', (e)=>{
      camera.fov = THREE.MathUtils.clamp(camera.fov + (e.deltaY > 0 ? 2 : -2), 50, 85);
      camera.updateProjectionMatrix();
    }, {passive:true});

    // --- render loop ---
    const clock = new THREE.Clock();
    function animate(){
      requestAnimationFrame(animate);
      const dt = clock.getDelta();

      // smoothing (lerp)
      const lerp = (a,b,t)=>a+(b-a)*t;
      yaw   = lerp(yaw,   targetYaw,   6*dt);
      pitch = lerp(pitch, targetPitch, 6*dt);

      // set rotasi kamera terhadap titik fokus layar
      const focus = new THREE.Vector3(0, 2.6, -8.9); // kira2 pusat layar
      camera.lookAt(focus);
      camera.rotation.order = 'YXZ';
      camera.rotation.y += yaw;
      camera.rotation.x += pitch;

      renderer.render(scene, camera);
    }
    animate();

    // resize
    addEventListener('resize', ()=>{
      camera.aspect = innerWidth/innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(innerWidth, innerHeight);
    });
  </script>
</body>
</html>
